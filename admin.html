<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Energy Dominion</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="admin-mode">

    <h2 class="neon-text-blue" style="text-align: center; margin-bottom: 20px;">Command Center</h2>
    
    <div class="admin-controls" style="margin-bottom: 20px;">
        <button id="btn-start" style="border-color: var(--neon-green);">Start Game</button>
        <button id="btn-freeze" style="border-color: var(--neon-blue);">Toggle Freeze</button>
        <button id="btn-showdown" class="btn-red">Final Showdown</button>
        <button id="btn-reset">Reset Game</button>
    </div>

    <div id="admin-teams" class="admin-grid">
        </div>

    <script type="module">
        import { db, ref, onValue, update, set } from './firebase.js';

        const gameRef = ref(db, 'game');
        let currentGameState = {};

        // Default setup for 4 teams
        const defaultTeams = {
            team1: { name: "Alpha Squadron", energy: 100, eliminated: false, roles: { strategist: true, runner: true } },
            team2: { name: "Bravo Vanguard", energy: 100, eliminated: false, roles: { strategist: true, runner: true } },
            team3: { name: "Charlie Vertex", energy: 100, eliminated: false, roles: { strategist: true, runner: true } },
            team4: { name: "Delta Prime", energy: 100, eliminated: false, roles: { strategist: true, runner: true } }
        };

        // Listen for state to render buttons
        onValue(gameRef, (snapshot) => {
            currentGameState = snapshot.val() || { status: 'intro', teams: defaultTeams };
            renderTeams();
        });

        function adjustEnergy(teamId, amount) {
            let newEnergy = (currentGameState.teams[teamId].energy || 0) + amount;
            if (newEnergy > 100) newEnergy = 100;
            if (newEnergy <= 0) {
                newEnergy = 0;
                update(ref(db, `game/teams/${teamId}`), { eliminated: true });
            }
            update(ref(db, `game/teams/${teamId}`), { energy: newEnergy });
        }

        function renderTeams() {
            const container = document.getElementById('admin-teams');
            container.innerHTML = '';
            for (const [id, team] of Object.entries(currentGameState.teams || {})) {
                const div = document.createElement('div');
                div.className = 'admin-team';
                div.innerHTML = `
                    <h3>${team.name} - ${team.energy}%</h3>
                    <div class="btn-group">
                        <button onclick="window.adjustEnergy('${id}', -10)" class="btn-red">-10</button>
                        <button onclick="window.adjustEnergy('${id}', -5)" class="btn-red">-5</button>
                        <button onclick="window.adjustEnergy('${id}', 5)">+5</button>
                        <button onclick="window.adjustEnergy('${id}', 10)">+10</button>
                    </div>
                `;
                container.appendChild(div);
            }
        }
        window.adjustEnergy = adjustEnergy; // Expose to inline onclick

        // Global Controls
        document.getElementById('btn-start').onclick = () => update(gameRef, { status: 'playing' });
        document.getElementById('btn-freeze').onclick = () => {
            const newStatus = currentGameState.status === 'frozen' ? 'playing' : 'frozen';
            update(gameRef, { status: newStatus });
        };
        document.getElementById('btn-showdown').onclick = () => update(gameRef, { status: 'showdown' });
        document.getElementById('btn-reset').onclick = () => set(gameRef, { status: 'intro', teams: defaultTeams });
    </script>
</body>
</html>
